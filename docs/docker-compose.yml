version: "3.8"

services:
  senzor:
    # Official Senzor Agent Image
    image: ghcr.io/senzops/server-agent:latest
    container_name: senzor
    restart: unless-stopped

    # CRITICAL: Network and PID must be 'host' to monitor the actual server
    network_mode: "host"
    pid: "host"

    # Mount host directories strictly Read-Only (:ro) for security
    volumes:
      - /:/host/root:ro
      - /sys:/host/sys:ro
      - /proc:/host/proc:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro

    # Configuration
    environment:
      # 1. API Configuration
      # If self-hosting, change this to your backend URL (e.g. http://your-ip:5000/api/ingest/stats)
      - API_ENDPOINT=https://api.senzor.dev/api/ingest/stats

      # 2. Authentication (Get these from your Dashboard)
      - VPS_ID=REPLACE_WITH_YOUR_VPS_ID
      - API_KEY=REPLACE_WITH_YOUR_API_KEY

      # 3. Settings
      - INTERVAL=60 # Seconds between checks
      - NODE_ENV=production

    # Resource Limits (Safety Guardrails)
    # Ensures the agent never consumes too much of your server's resources
    deploy:
      resources:
        limits:
          memory: 150M
          cpus: "0.10" # Max 10% of 1 CPU Core
        reservations:
          memory: 30M
